require "integrations/requests/workflow/spec_helper"
describe "dna_rna_manual_extraction" do
  include_context "use core context service"
  include_context 'setup_s2_environment_for_dna_rna_manual_extraction'
  it "dna_rna_manual_extraction" do

    header('Accept', 'application/json')
    header('Content-Type', 'application/json')



  # Get the root JSON


    response = get "/" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"actions\":{\"create\":\"http://example.org/actions/action\"}},\"batches\":{\"actions\":{\"create\":\"http://example.org/batches\",\"read\":\"http://example.org/batches\",\"first\":\"http://example.org/batches/page=1\",\"last\":\"http://example.org/batches/page=-1\"}},\"users\":{\"actions\":{\"create\":\"http://example.org/users\",\"read\":\"http://example.org/users\",\"first\":\"http://example.org/users/page=1\",\"last\":\"http://example.org/users/page=-1\"}},\"studies\":{\"actions\":{\"create\":\"http://example.org/studies\",\"read\":\"http://example.org/studies\",\"first\":\"http://example.org/studies/page=1\",\"last\":\"http://example.org/studies/page=-1\"}},\"orders\":{\"actions\":{\"create\":\"http://example.org/orders\",\"read\":\"http://example.org/orders\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"}},\"projects\":{\"actions\":{\"create\":\"http://example.org/projects\",\"read\":\"http://example.org/projects\",\"first\":\"http://example.org/projects/page=1\",\"last\":\"http://example.org/projects/page=-1\"}},\"samples\":{\"actions\":{\"create\":\"http://example.org/samples\",\"read\":\"http://example.org/samples\",\"first\":\"http://example.org/samples/page=1\",\"last\":\"http://example.org/samples/page=-1\"}},\"oligos\":{\"actions\":{\"create\":\"http://example.org/oligos\",\"read\":\"http://example.org/oligos\",\"first\":\"http://example.org/oligos/page=1\",\"last\":\"http://example.org/oligos/page=-1\"}},\"aliquots\":{\"actions\":{\"create\":\"http://example.org/aliquots\",\"read\":\"http://example.org/aliquots\",\"first\":\"http://example.org/aliquots/page=1\",\"last\":\"http://example.org/aliquots/page=-1\"}},\"flowcells\":{\"actions\":{\"create\":\"http://example.org/flowcells\",\"read\":\"http://example.org/flowcells\",\"first\":\"http://example.org/flowcells/page=1\",\"last\":\"http://example.org/flowcells/page=-1\"}},\"gels\":{\"actions\":{\"create\":\"http://example.org/gels\",\"read\":\"http://example.org/gels\",\"first\":\"http://example.org/gels/page=1\",\"last\":\"http://example.org/gels/page=-1\"}},\"labellables\":{\"actions\":{\"create\":\"http://example.org/labellables\",\"read\":\"http://example.org/labellables\",\"first\":\"http://example.org/labellables/page=1\",\"last\":\"http://example.org/labellables/page=-1\"}},\"sanger_barcodes\":{\"actions\":{\"create\":\"http://example.org/sanger_barcodes\",\"read\":\"http://example.org/sanger_barcodes\",\"first\":\"http://example.org/sanger_barcodes/page=1\",\"last\":\"http://example.org/sanger_barcodes/page=-1\"}},\"ean13_barcodes\":{\"actions\":{\"create\":\"http://example.org/ean13_barcodes\",\"read\":\"http://example.org/ean13_barcodes\",\"first\":\"http://example.org/ean13_barcodes/page=1\",\"last\":\"http://example.org/ean13_barcodes/page=-1\"}},\"barcode2_ds\":{\"actions\":{\"create\":\"http://example.org/barcode2_ds\",\"read\":\"http://example.org/barcode2_ds\",\"first\":\"http://example.org/barcode2_ds/page=1\",\"last\":\"http://example.org/barcode2_ds/page=-1\"}},\"plates\":{\"actions\":{\"create\":\"http://example.org/plates\",\"read\":\"http://example.org/plates\",\"first\":\"http://example.org/plates/page=1\",\"last\":\"http://example.org/plates/page=-1\"}},\"spin_columns\":{\"actions\":{\"create\":\"http://example.org/spin_columns\",\"read\":\"http://example.org/spin_columns\",\"first\":\"http://example.org/spin_columns/page=1\",\"last\":\"http://example.org/spin_columns/page=-1\"}},\"tubes\":{\"actions\":{\"create\":\"http://example.org/tubes\",\"read\":\"http://example.org/tubes\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"}},\"tube_racks\":{\"actions\":{\"create\":\"http://example.org/tube_racks\",\"read\":\"http://example.org/tube_racks\",\"first\":\"http://example.org/tube_racks/page=1\",\"last\":\"http://example.org/tube_racks/page=-1\"}},\"tag_groups\":{\"actions\":{\"create\":\"http://example.org/tag_groups\",\"read\":\"http://example.org/tag_groups\",\"first\":\"http://example.org/tag_groups/page=1\",\"last\":\"http://example.org/tag_groups/page=-1\"}},\"searches\":{\"actions\":{\"create\":\"http://example.org/searches\",\"read\":\"http://example.org/searches\",\"first\":\"http://example.org/searches/page=1\",\"last\":\"http://example.org/searches/page=-1\"}},\"multi_criteria_filters\":{\"actions\":{\"create\":\"http://example.org/multi_criteria_filters\",\"read\":\"http://example.org/multi_criteria_filters\",\"first\":\"http://example.org/multi_criteria_filters/page=1\",\"last\":\"http://example.org/multi_criteria_filters/page=-1\"}},\"label_filters\":{\"actions\":{\"create\":\"http://example.org/label_filters\",\"read\":\"http://example.org/label_filters\",\"first\":\"http://example.org/label_filters/page=1\",\"last\":\"http://example.org/label_filters/page=-1\"}},\"order_filters\":{\"actions\":{\"create\":\"http://example.org/order_filters\",\"read\":\"http://example.org/order_filters\",\"first\":\"http://example.org/order_filters/page=1\",\"last\":\"http://example.org/order_filters/page=-1\"}},\"batch_filters\":{\"actions\":{\"create\":\"http://example.org/batch_filters\",\"read\":\"http://example.org/batch_filters\",\"first\":\"http://example.org/batch_filters/page=1\",\"last\":\"http://example.org/batch_filters/page=-1\"}},\"uuid_resources\":{\"actions\":{\"create\":\"http://example.org/uuid_resources\",\"read\":\"http://example.org/uuid_resources\",\"first\":\"http://example.org/uuid_resources/page=1\",\"last\":\"http://example.org/uuid_resources/page=-1\"}},\"create_batches\":{\"actions\":{\"create\":\"http://example.org/actions/create_batch\"}},\"create_flowcells\":{\"actions\":{\"create\":\"http://example.org/actions/create_flowcell\"}},\"create_gels\":{\"actions\":{\"create\":\"http://example.org/actions/create_gel\"}},\"create_labels\":{\"actions\":{\"create\":\"http://example.org/actions/create_label\"}},\"create_labellables\":{\"actions\":{\"create\":\"http://example.org/actions/create_labellable\"}},\"create_orders\":{\"actions\":{\"create\":\"http://example.org/actions/create_order\"}},\"create_plates\":{\"actions\":{\"create\":\"http://example.org/actions/create_plate\"}},\"create_searches\":{\"actions\":{\"create\":\"http://example.org/actions/create_search\"}},\"create_spin_columns\":{\"actions\":{\"create\":\"http://example.org/actions/create_spin_column\"}},\"create_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/create_tube\"}},\"create_tube_racks\":{\"actions\":{\"create\":\"http://example.org/actions/create_tube_rack\"}},\"plate_transfers\":{\"actions\":{\"create\":\"http://example.org/actions/plate_transfer\"}},\"tag_wells\":{\"actions\":{\"create\":\"http://example.org/actions/tag_wells\"}},\"transfer_plates_to_plates\":{\"actions\":{\"create\":\"http://example.org/actions/transfer_plates_to_plates\"}},\"transfer_tubes_to_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/transfer_tubes_to_tubes\"}},\"transfer_wells_to_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/transfer_wells_to_tubes\"}},\"tube_rack_moves\":{\"actions\":{\"create\":\"http://example.org/actions/tube_rack_move\"}},\"tube_rack_transfers\":{\"actions\":{\"create\":\"http://example.org/actions/tube_rack_transfer\"}},\"update_orders\":{\"actions\":{\"create\":\"http://example.org/actions/update_order\"}},\"update_plates\":{\"actions\":{\"create\":\"http://example.org/actions/update_plate\"}},\"update_tubes\":{\"actions\":{\"create\":\"http://example.org/actions/update_tube\"}},\"update_tube_racks\":{\"actions\":{\"create\":\"http://example.org/actions/update_tube_rack\"}},\"revision\":3}"



  # Find tube by barcode for 1220017279667


    response = post "/searches", "{\"search\":{\"description\":\"search for barcoded tube\",\"model\":\"tube\",\"criteria\":{\"label\":{\"position\":\"barcode\",\"type\":\"ean13-barcode\",\"value\":\"1220017279667\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/3dd7b620-739b-0130-e17c-282066132de2\",\"first\":\"http://example.org/3dd7b620-739b-0130-e17c-282066132de2/page=1\",\"last\":\"http://example.org/3dd7b620-739b-0130-e17c-282066132de2/page=-1\"},\"uuid\":\"3dd7b620-739b-0130-e17c-282066132de2\"}}"

  # Get the search result (tube)


    response = get "/3dd7b620-739b-0130-e17c-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/tubes/page=1\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"},\"size\":1,\"tubes\":[{\"actions\":{\"read\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/3ddc8c40-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3ddc8c40-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3ddc8c40-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3ddc8c40-739b-0130-e17c-282066132de2\"},\"uuid\":\"3ddc8c40-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387e4a50-739b-0130-e1a1-282066132de2\",\"barcode\":{\"value\":\"1220017279667\",\"type\":\"ean13-barcode\"}}}]}"

  # Find tube by barcode for 1220017279668


    response = post "/searches", "{\"search\":{\"description\":\"search for barcoded tube\",\"model\":\"tube\",\"criteria\":{\"label\":{\"position\":\"barcode\",\"type\":\"ean13-barcode\",\"value\":\"1220017279668\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/3dde8100-739b-0130-e17c-282066132de2\",\"first\":\"http://example.org/3dde8100-739b-0130-e17c-282066132de2/page=1\",\"last\":\"http://example.org/3dde8100-739b-0130-e17c-282066132de2/page=-1\"},\"uuid\":\"3dde8100-739b-0130-e17c-282066132de2\"}}"

  # Get the search result (tube)


    response = get "/3dde8100-739b-0130-e17c-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/tubes/page=1\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"},\"size\":1,\"tubes\":[{\"actions\":{\"read\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/3de25690-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3de25690-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3de25690-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3de25690-739b-0130-e17c-282066132de2\"},\"uuid\":\"3de25690-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387fc8c0-739b-0130-e1a1-282066132de2\",\"barcode\":{\"value\":\"1220017279668\",\"type\":\"ean13-barcode\"}}}]}"

  # Find the order by tube uuid and role


    response = post "/searches", "{\"search\":{\"description\":\"search for order\",\"model\":\"order\",\"criteria\":{\"item\":{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"role\":\"tube_to_be_extracted_na+p\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/3de44200-739b-0130-e17c-282066132de2\",\"first\":\"http://example.org/3de44200-739b-0130-e17c-282066132de2/page=1\",\"last\":\"http://example.org/3de44200-739b-0130-e17c-282066132de2/page=-1\"},\"uuid\":\"3de44200-739b-0130-e17c-282066132de2\"}}"

  # Get the search results (order)


    response = get "/3de44200-739b-0130-e17c-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/orders/page=1\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"},\"size\":1,\"orders\":[{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":null},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":null}]}}]}"

  # Create a new batch


    response = post "/batches", "{\"batch\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}"

  # Assign the batch uuid to the tubes in the order items


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"tube_to_be_extracted_na+p\":{\"387e3a10-739b-0130-e1a1-282066132de2\":{\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"387fb8d0-739b-0130-e1a1-282066132de2\":{\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Add the tube_to_be_extracted_nap under the role binding_tube_to_be_extracted_nap and start them.


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"387e3a10-739b-0130-e1a1-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"387fb8d0-739b-0130-e1a1-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the status of binding_tube_to_be_extracted_nap to done. Change the status of tube_to_be_extracted_nap to unused.


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"387e3a10-739b-0130-e1a1-282066132de2\":{\"event\":\"complete\"},\"387fb8d0-739b-0130-e1a1-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_na+p\":{\"387e3a10-739b-0130-e1a1-282066132de2\":{\"event\":\"unuse\"},\"387fb8d0-739b-0130-e1a1-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Find tube by barcode for 1220017279669


    response = post "/searches", "{\"search\":{\"description\":\"search for barcoded tube\",\"model\":\"tube\",\"criteria\":{\"label\":{\"position\":\"barcode\",\"type\":\"ean13-barcode\",\"value\":\"1220017279669\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/3e7e1da0-739b-0130-e17c-282066132de2\",\"first\":\"http://example.org/3e7e1da0-739b-0130-e17c-282066132de2/page=1\",\"last\":\"http://example.org/3e7e1da0-739b-0130-e17c-282066132de2/page=-1\"},\"uuid\":\"3e7e1da0-739b-0130-e17c-282066132de2\"}}"

  # Get the search result (tube)


    response = get "/3e7e1da0-739b-0130-e17c-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/tubes/page=1\",\"first\":\"http://example.org/tubes/page=1\",\"last\":\"http://example.org/tubes/page=-1\"},\"size\":1,\"tubes\":[{\"actions\":{\"read\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/3eab2930-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3eab2930-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3eab2930-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3eab2930-739b-0130-e17c-282066132de2\"},\"uuid\":\"3eab2930-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388157a0-739b-0130-e1a1-282066132de2\",\"barcode\":{\"value\":\"1220017279669\",\"type\":\"ean13-barcode\"}}}]}"

  # Find the order by tube uuid and role


    response = post "/searches", "{\"search\":{\"description\":\"search for order\",\"model\":\"order\",\"criteria\":{\"item\":{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"role\":\"tube_to_be_extracted_na+p\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/3eacb5a0-739b-0130-e17c-282066132de2\",\"first\":\"http://example.org/3eacb5a0-739b-0130-e17c-282066132de2/page=1\",\"last\":\"http://example.org/3eacb5a0-739b-0130-e17c-282066132de2/page=-1\"},\"uuid\":\"3eacb5a0-739b-0130-e17c-282066132de2\"}}"

  # Get the search results (order)


    response = get "/3eacb5a0-739b-0130-e17c-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/orders/page=1\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"},\"size\":1,\"orders\":[{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":null}]}}]}"

  # Assign the batch uuid to the tubes in the order items


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"tube_to_be_extracted_na+p\":{\"388146d0-739b-0130-e1a1-282066132de2\":{\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Add the tube_to_be_extracted_nap under the role binding_tube_to_be_extracted_nap and start them.


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"388146d0-739b-0130-e1a1-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the status of binding_tube_to_be_extracted_nap to done. Change the status of tube_to_be_extracted_nap to unused.


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_tube_to_be_extracted_na+p\":{\"388146d0-739b-0130-e1a1-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_na+p\":{\"388146d0-739b-0130-e1a1-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create the search order by batch


    response = post "/searches", "{\"search\":{\"description\":\"search order by batch\",\"model\":\"order\",\"criteria\":{\"item\":{\"batch\":\"3dee3590-739b-0130-e17c-282066132de2\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"search\":{\"actions\":{\"read\":\"http://example.org/3f0f3060-739b-0130-e17c-282066132de2\",\"first\":\"http://example.org/3f0f3060-739b-0130-e17c-282066132de2/page=1\",\"last\":\"http://example.org/3f0f3060-739b-0130-e17c-282066132de2/page=-1\"},\"uuid\":\"3f0f3060-739b-0130-e17c-282066132de2\"}}"

  # Get the result orders


    response = get "/3f0f3060-739b-0130-e17c-282066132de2/page=1" 
    response.status.should == 200
    response.body.should match_json "{\"actions\":{\"read\":\"http://example.org/orders/page=1\",\"first\":\"http://example.org/orders/page=1\",\"last\":\"http://example.org/orders/page=-1\"},\"size\":2,\"orders\":[{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}},{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"draft\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}]}"



  # Change the status of the order to pending


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"event\":\"build\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"pending\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the status of the order to in_progress


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"event\":\"start\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Change the status of the order to pending


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"event\":\"build\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"pending\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the status of the order to in_progress


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"event\":\"start\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\"},\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\"},\"uuid\":\"3f89bf40-739b-0130-e17c-282066132de2\",\"name\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"3fa29820-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fb74410-739b-0130-e17c-282066132de2\",\"name\":\"3fa29820-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"3fcea780-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fe50050-739b-0130-e17c-282066132de2\",\"name\":\"3fcea780-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4022fcd0-739b-0130-e17c-282066132de2\",\"name\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"3f7a1080-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"3fa29820-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}},\"by_product_tube_rna+p\":{\"3fcea780-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"3ffc72e0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_dna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"},{\"source_uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387e3a10-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/40bcd5e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40bcd5e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40bcd5e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40bcd5e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"40bcd5e0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387e4a50-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387e4a50-739b-0130-e1a1-282066132de2\",\"barcode\":{\"value\":\"1220017279667\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387fb8d0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/40bd3a10-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40bd3a10-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40bd3a10-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40bd3a10-739b-0130-e17c-282066132de2\"},\"uuid\":\"40bd3a10-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387fc8c0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387fc8c0-739b-0130-e1a1-282066132de2\",\"barcode\":{\"value\":\"1220017279668\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\"},\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/40bda230-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40bda230-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40bda230-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40bda230-739b-0130-e17c-282066132de2\"},\"uuid\":\"40bda230-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\"},\"uuid\":\"3f89bf40-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/40be0430-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40be0430-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40be0430-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40be0430-739b-0130-e17c-282066132de2\"},\"uuid\":\"40be0430-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fb74410-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/40be67a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40be67a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40be67a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40be67a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"40be67a0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fe50050-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/40bec960-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40bec960-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40bec960-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40bec960-739b-0130-e17c-282066132de2\"},\"uuid\":\"40bec960-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4022fcd0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"},{\"source_uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}]}}"

  # Change the status of the binding_spin_column_dna to done. Change the status of the by_product_tube to done. Change the status of the tube_to_be_extracted to unused


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"3f7a1080-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"3fa29820-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"3fcea780-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"3ffc72e0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"binding_tube_to_be_extracted_na+p\":{\"387e3a10-739b-0130-e1a1-282066132de2\":{\"event\":\"unuse\"},\"387fb8d0-739b-0130-e1a1-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\"},\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"45f59a80-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"460cf6e0-739b-0130-e17c-282066132de2\",\"name\":\"45f59a80-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\"},\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"46277610-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\"},\"uuid\":\"4650ca60-739b-0130-e17c-282066132de2\",\"name\":\"46277610-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"45f59a80-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}},\"by_product_tube_rna+p\":{\"46277610-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_dna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388146d0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/46be80a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46be80a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46be80a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46be80a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"46be80a0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"quantity\":1000,\"type\":\"NA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388157a0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388157a0-739b-0130-e1a1-282066132de2\",\"barcode\":{\"value\":\"1220017279669\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\"},\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/46bee5e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46bee5e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46bee5e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46bee5e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"46bee5e0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"460cf6e0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\"},\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/46bf4890-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46bf4890-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46bf4890-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46bf4890-739b-0130-e17c-282066132de2\"},\"uuid\":\"46bf4890-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\"},\"uuid\":\"4650ca60-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"DNA\"},{\"source_uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"target_uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA+P\"}]}}"

  # Change the status of the binding_spin_column_dna to done. Change the status of the by_product_tube to done. Change the status of the tube_to_be_extracted to unused


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_dna\":{\"45f59a80-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"46277610-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"binding_tube_to_be_extracted_na+p\":{\"388146d0-739b-0130-e1a1-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"410363b0-739b-0130-e17c-282066132de2\",\"name\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\"},\"uuid\":\"41538060-739b-0130-e17c-282066132de2\",\"name\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_dna_tube in the order and start them


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"40efb5e0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"412f7bd0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_dna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"target_uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"target_uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3f7a1080-739b-0130-e17c-282066132de2\"},\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/41c893f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41c893f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41c893f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41c893f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"41c893f0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3f89bf40-739b-0130-e17c-282066132de2\"},\"uuid\":\"3f89bf40-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fa29820-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/41c8f790-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41c8f790-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41c8f790-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41c8f790-739b-0130-e17c-282066132de2\"},\"uuid\":\"41c8f790-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fb74410-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fb74410-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/41c95bc0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41c95bc0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41c95bc0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41c95bc0-739b-0130-e17c-282066132de2\"},\"uuid\":\"41c95bc0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"410363b0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/41c9c0a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41c9c0a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41c9c0a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41c9c0a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"41c9c0a0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\"},\"uuid\":\"41538060-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"target_uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"target_uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_dna to unused


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"40efb5e0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"412f7bd0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_dna\":{\"3f7a1080-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"},\"3fa29820-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\"},\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"46eede00-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"470076f0-739b-0130-e17c-282066132de2\",\"name\":\"46eede00-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_dna_tube in the order and start them


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"46eede00-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_dna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"target_uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/45f59a80-739b-0130-e17c-282066132de2\"},\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/47760a60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47760a60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47760a60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47760a60-739b-0130-e17c-282066132de2\"},\"uuid\":\"47760a60-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/460cf6e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"460cf6e0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891500\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\"},\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/47767530-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47767530-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47767530-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47767530-739b-0130-e17c-282066132de2\"},\"uuid\":\"47767530-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"470076f0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"target_uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_dna to unused


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"46eede00-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_dna\":{\"45f59a80-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"420f57a0-739b-0130-e17c-282066132de2\",\"name\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\"},\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"423f0880-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\"},\"uuid\":\"42615a00-739b-0130-e17c-282066132de2\",\"name\":\"423f0880-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}}}}"

  # Add tube_to_be_extracted tubes in the order and start them.


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"41fc42f0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"423f0880-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer from by_product_tube tubes into tube_to_be_extracted tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"target_uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fcea780-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/42d7c3a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/42d7c3a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/42d7c3a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/42d7c3a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"42d7c3a0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3fe50050-739b-0130-e17c-282066132de2\"},\"uuid\":\"3fe50050-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567893000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3ffc72e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/42d838f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/42d838f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/42d838f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/42d838f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"42d838f0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4022fcd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4022fcd0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567894000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/42d89c70-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/42d89c70-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/42d89c70-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/42d89c70-739b-0130-e17c-282066132de2\"},\"uuid\":\"42d89c70-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"420f57a0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\"},\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/42d91dd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/42d91dd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/42d91dd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/42d91dd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"42d91dd0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\"},\"uuid\":\"42615a00-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"target_uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to done


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"41fc42f0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"423f0880-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"3fcea780-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"},\"3ffc72e0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\"},\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\"},\"uuid\":\"47b5ef70-739b-0130-e17c-282066132de2\",\"name\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}}}}"

  # Add tube_to_be_extracted tubes in the order and start them.


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"47a44fb0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer from by_product_tube tubes into tube_to_be_extracted tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"target_uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46277610-739b-0130-e17c-282066132de2\"},\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/483da5e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/483da5e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/483da5e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/483da5e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"483da5e0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4650ca60-739b-0130-e17c-282066132de2\"},\"uuid\":\"4650ca60-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891600\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\"},\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/484283b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/484283b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/484283b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/484283b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"484283b0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\"},\"uuid\":\"47b5ef70-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"target_uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to done


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"tube_to_be_extracted_rna+p\":{\"47a44fb0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"46277610-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\"},\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"431df1d0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\"},\"uuid\":\"43295e70-739b-0130-e17c-282066132de2\",\"name\":\"431df1d0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\"},\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"43440930-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\"},\"uuid\":\"435a6d20-739b-0130-e17c-282066132de2\",\"name\":\"43440930-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\"},\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4374e610-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891100\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\"},\"uuid\":\"4389ff40-739b-0130-e17c-282066132de2\",\"name\":\"4374e610-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891100\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\"},\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"43a9b970-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891200\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\"},\"uuid\":\"43d066d0-739b-0130-e17c-282066132de2\",\"name\":\"43a9b970-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891200\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"431df1d0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"43440930-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}},\"by_product_tube_rna+p\":{\"4374e610-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"43a9b970-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_rna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"target_uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null},{\"source_uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"target_uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41fc42f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/44419ec0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44419ec0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44419ec0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44419ec0-739b-0130-e17c-282066132de2\"},\"uuid\":\"44419ec0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/420f57a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"420f57a0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567897000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/423f0880-739b-0130-e17c-282066132de2\"},\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/44420480-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44420480-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44420480-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44420480-739b-0130-e17c-282066132de2\"},\"uuid\":\"44420480-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/42615a00-739b-0130-e17c-282066132de2\"},\"uuid\":\"42615a00-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567898000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\"},\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/444268b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/444268b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/444268b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/444268b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"444268b0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\"},\"uuid\":\"43295e70-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\"},\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4442caa0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4442caa0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4442caa0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4442caa0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4442caa0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\"},\"uuid\":\"435a6d20-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4374e610-739b-0130-e17c-282066132de2\"},\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/44433870-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44433870-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44433870-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44433870-739b-0130-e17c-282066132de2\"},\"uuid\":\"44433870-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4389ff40-739b-0130-e17c-282066132de2\"},\"uuid\":\"4389ff40-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891100\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43a9b970-739b-0130-e17c-282066132de2\"},\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/44439d90-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44439d90-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44439d90-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44439d90-739b-0130-e17c-282066132de2\"},\"uuid\":\"44439d90-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43d066d0-739b-0130-e17c-282066132de2\"},\"uuid\":\"43d066d0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891200\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"target_uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null},{\"source_uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"target_uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}]}}"

  # Change the status of binding_spin_column_rna to done. Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to unused


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"431df1d0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"43440930-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"4374e610-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"43a9b970-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_rna+p\":{\"41fc42f0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"},\"423f0880-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new spin columns


    response = post "/spin_columns", "{\"spin_column\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"486e03f0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\"},\"uuid\":\"487ddd80-739b-0130-e17c-282066132de2\",\"name\":\"486e03f0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}}}}"

  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\"},\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4895f040-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\"},\"uuid\":\"48ad8720-739b-0130-e17c-282066132de2\",\"name\":\"4895f040-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}"

  # Add the new spin columns and new tubes in the order and start each of them


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"486e03f0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}},\"by_product_tube_rna+p\":{\"4895f040-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfers from tube_to_be_extracted into binding_spin_column_rna spins and into by_product_tube tubes.


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47a44fb0-739b-0130-e17c-282066132de2\"},\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/491e6000-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/491e6000-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/491e6000-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/491e6000-739b-0130-e17c-282066132de2\"},\"uuid\":\"491e6000-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/47b5ef70-739b-0130-e17c-282066132de2\"},\"uuid\":\"47b5ef70-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891800\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/491ec9b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/491ec9b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/491ec9b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/491ec9b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"491ec9b0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\"},\"uuid\":\"487ddd80-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4895f040-739b-0130-e17c-282066132de2\"},\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/491f2d10-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/491f2d10-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/491f2d10-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/491f2d10-739b-0130-e17c-282066132de2\"},\"uuid\":\"491f2d10-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA+P\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/48ad8720-739b-0130-e17c-282066132de2\"},\"uuid\":\"48ad8720-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892000\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":\"RNA\"},{\"source_uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"fraction\":0.5,\"aliquot_type\":null}]}}"

  # Change the status of binding_spin_column_rna to done. Change the status of by_product_tube to done. Change the status of tube_to_be_extracted to unused


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"binding_spin_column_rna\":{\"486e03f0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"by_product_tube_rna+p\":{\"4895f040-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"tube_to_be_extracted_rna+p\":{\"47a44fb0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"447e89b0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\"},\"uuid\":\"448b4f60-739b-0130-e17c-282066132de2\",\"name\":\"447e89b0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\"},\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\"},\"uuid\":\"44de2ea0-739b-0130-e17c-282066132de2\",\"name\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_rna_tube in the order and start them


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"447e89b0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"44bc3bc0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_rna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"target_uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/431df1d0-739b-0130-e17c-282066132de2\"},\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/456f5a60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/456f5a60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/456f5a60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/456f5a60-739b-0130-e17c-282066132de2\"},\"uuid\":\"456f5a60-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43295e70-739b-0130-e17c-282066132de2\"},\"uuid\":\"43295e70-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567899000\",\"type\":\"ean13-barcode\"}}}},{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/43440930-739b-0130-e17c-282066132de2\"},\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/456fbe80-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/456fbe80-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/456fbe80-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/456fbe80-739b-0130-e17c-282066132de2\"},\"uuid\":\"456fbe80-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/435a6d20-739b-0130-e17c-282066132de2\"},\"uuid\":\"435a6d20-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/45702140-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/45702140-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/45702140-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/45702140-739b-0130-e17c-282066132de2\"},\"uuid\":\"45702140-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\"},\"uuid\":\"448b4f60-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\"},\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/45708840-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/45708840-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/45708840-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/45708840-739b-0130-e17c-282066132de2\"},\"uuid\":\"45708840-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\"},\"uuid\":\"44de2ea0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"target_uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_rna to unused


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"447e89b0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"44bc3bc0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_rna\":{\"431df1d0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"},\"43440930-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes 


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\"},\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"49542970-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\"},\"uuid\":\"496d3790-739b-0130-e17c-282066132de2\",\"name\":\"49542970-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}}}}"

  # Add the extracted_rna_tube in the order and start them


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"49542970-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer binding_spin_column_rna into extracted_tube


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"spin_column\":{\"actions\":{\"read\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/486e03f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/49f83f60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/49f83f60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/49f83f60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/49f83f60-739b-0130-e17c-282066132de2\"},\"uuid\":\"49f83f60-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/487ddd80-739b-0130-e17c-282066132de2\"},\"uuid\":\"487ddd80-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891900\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\"},\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/49fa2bd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/49fa2bd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/49fa2bd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/49fa2bd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"49fa2bd0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\"},\"uuid\":\"496d3790-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to done. Change the status of binding_spin_column_rna to unused


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"49542970-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}},\"binding_spin_column_rna\":{\"486e03f0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a5743e0-739b-0130-e17c-282066132de2\",\"name\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a98ecc0-739b-0130-e17c-282066132de2\",\"name\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"name\":{\"4a4706a0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"4a6ec850-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/447e89b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4b1fa160-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4b1fa160-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4b1fa160-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4b1fa160-739b-0130-e17c-282066132de2\"},\"uuid\":\"4b1fa160-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/448b4f60-739b-0130-e17c-282066132de2\"},\"uuid\":\"448b4f60-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891300\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44bc3bc0-739b-0130-e17c-282066132de2\"},\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4b200bf0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4b200bf0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4b200bf0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4b200bf0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4b200bf0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/44de2ea0-739b-0130-e17c-282066132de2\"},\"uuid\":\"44de2ea0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891400\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4b2071c0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4b2071c0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4b2071c0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4b2071c0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4b2071c0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a5743e0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4b20d690-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4b20d690-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4b20d690-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4b20d690-739b-0130-e17c-282066132de2\"},\"uuid\":\"4b20d690-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a98ecc0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"447e89b0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"},\"44bc3bc0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"4a4706a0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"4a6ec850-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"A2\":\"4a6ec850-739b-0130-e17c-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/4b539010-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4b539010-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4b539010-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4b539010-739b-0130-e17c-282066132de2\"},\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a4706a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4b7309b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4b7309b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4b7309b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4b7309b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4b7309b0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a5743e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a5743e0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892200\",\"type\":\"2d-barcode\"}}},\"A2\":{\"actions\":{\"read\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a6ec850-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4b7374b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4b7374b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4b7374b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4b7374b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4b7374b0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4a98ecc0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4a98ecc0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892300\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock RNA\":{\"4b539010-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock RNA\":{\"4b539010-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\"},\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\"},\"uuid\":\"4bc2d970-739b-0130-e17c-282066132de2\",\"name\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"name\":{\"4bb40c10-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/49542970-739b-0130-e17c-282066132de2\"},\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4c3934a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4c3934a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4c3934a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4c3934a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4c3934a0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/496d3790-739b-0130-e17c-282066132de2\"},\"uuid\":\"496d3790-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892100\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\"},\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4c39a840-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4c39a840-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4c39a840-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4c39a840-739b-0130-e17c-282066132de2\"},\"uuid\":\"4c39a840-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\"},\"uuid\":\"4bc2d970-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_rna\":{\"49542970-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"4bb40c10-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"4bb40c10-739b-0130-e17c-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/4c703770-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4c703770-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4c703770-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4c703770-739b-0130-e17c-282066132de2\"},\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4bb40c10-739b-0130-e17c-282066132de2\"},\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4c7a8970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4c7a8970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4c7a8970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4c7a8970-739b-0130-e17c-282066132de2\"},\"uuid\":\"4c7a8970-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"RNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4bc2d970-739b-0130-e17c-282066132de2\"},\"uuid\":\"4bc2d970-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892400\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock RNA\":{\"4c703770-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock RNA\":{\"4c703770-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\"},\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4cde6740-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4cf496a0-739b-0130-e17c-282066132de2\",\"name\":\"4cde6740-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}}}}"



    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4d39f8f0-739b-0130-e17c-282066132de2\",\"name\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"name\":{\"4cde6740-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"},\"4d1014b0-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/40efb5e0-739b-0130-e17c-282066132de2\"},\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4db198a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4db198a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4db198a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4db198a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4db198a0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/410363b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"410363b0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567895000\",\"type\":\"ean13-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/412f7bd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4db201a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4db201a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4db201a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4db201a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4db201a0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/41538060-739b-0130-e17c-282066132de2\"},\"uuid\":\"41538060-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567896000\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\"},\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4db26840-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4db26840-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4db26840-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4db26840-739b-0130-e17c-282066132de2\"},\"uuid\":\"4db26840-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4cf496a0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}}}},{\"tube\":{\"actions\":{\"read\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4db2d820-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4db2d820-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4db2d820-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4db2d820-739b-0130-e17c-282066132de2\"},\"uuid\":\"4db2d820-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4d39f8f0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null},{\"source_uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"40efb5e0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"},\"412f7bd0-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"4cde6740-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"},\"4d1014b0-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"4cde6740-739b-0130-e17c-282066132de2\",\"A2\":\"4d1014b0-739b-0130-e17c-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/4de52660-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4de52660-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4de52660-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4de52660-739b-0130-e17c-282066132de2\"},\"uuid\":\"4de52660-739b-0130-e17c-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4cde6740-739b-0130-e17c-282066132de2\"},\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4df36ae0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4df36ae0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4df36ae0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4df36ae0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4df36ae0-739b-0130-e17c-282066132de2\",\"name\":\"sample_0\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4cf496a0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4cf496a0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892500\",\"type\":\"2d-barcode\"}}},\"A2\":{\"actions\":{\"read\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4d1014b0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4df3cff0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4df3cff0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4df3cff0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4df3cff0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4df3cff0-739b-0130-e17c-282066132de2\",\"name\":\"sample_1\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4d39f8f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4d39f8f0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892600\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock DNA\":{\"4de52660-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"4de52660-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock DNA\":{\"4de52660-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"4de52660-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"



  # Create new tubes


    response = post "/tubes", "{\"tube\":{\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube\":{\"actions\":{\"read\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\"},\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[]}}"



    response = post "/labellables", "{\"labellable\":{\"name\":\"4e522e50-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"labellable\":{\"actions\":{\"read\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\"},\"uuid\":\"4e5b1240-739b-0130-e17c-282066132de2\",\"name\":\"4e522e50-739b-0130-e17c-282066132de2\",\"type\":\"resource\",\"labels\":{\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}}}}"

  # Add the 2d tubes in the order and start them


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"name\":{\"4e522e50-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Transfer extracted tubes into 2D tubes


    response = post "/actions/transfer_tubes_to_tubes", "{\"transfer_tubes_to_tubes\":{\"transfers\":[{\"source_uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}],\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"transfer_tubes_to_tubes\":{\"actions\":{},\"user\":\"username\",\"application\":\"application\",\"result\":{\"sources\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/46eede00-739b-0130-e17c-282066132de2\"},\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4ec78b20-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4ec78b20-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4ec78b20-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4ec78b20-739b-0130-e17c-282066132de2\"},\"uuid\":\"4ec78b20-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/470076f0-739b-0130-e17c-282066132de2\"},\"uuid\":\"470076f0-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567891700\",\"type\":\"ean13-barcode\"}}}}],\"targets\":[{\"tube\":{\"actions\":{\"read\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\"},\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4ec7f640-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4ec7f640-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4ec7f640-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4ec7f640-739b-0130-e17c-282066132de2\"},\"uuid\":\"4ec7f640-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\"},\"uuid\":\"4e5b1240-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}}}}]},\"transfers\":[{\"source_uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"target_uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"fraction\":1,\"aliquot_type\":null}]}}"

  # Change the status of extracted_tube tubes to unused. Change the status of 2d tubes to complete


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"extracted_tube_dna\":{\"46eede00-739b-0130-e17c-282066132de2\":{\"event\":\"unuse\"}},\"name\":{\"4e522e50-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Create a new tube rack 


    response = post "/tube_racks", "{\"tube_rack\":{\"number_of_columns\":12,\"number_of_rows\":8,\"tubes\":{\"A1\":\"4e522e50-739b-0130-e17c-282066132de2\"},\"user\":\"username\"}}" 
    response.status.should == 200
    response.body.should match_json "{\"tube_rack\":{\"actions\":{\"read\":\"http://example.org/4efbbb10-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4efbbb10-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4efbbb10-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4efbbb10-739b-0130-e17c-282066132de2\"},\"uuid\":\"4efbbb10-739b-0130-e17c-282066132de2\",\"number_of_rows\":8,\"number_of_columns\":12,\"tubes\":{\"A1\":{\"actions\":{\"read\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4e522e50-739b-0130-e17c-282066132de2\"},\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"type\":null,\"max_volume\":null,\"aliquots\":[{\"sample\":{\"actions\":{\"read\":\"http://example.org/4f0cbfd0-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4f0cbfd0-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4f0cbfd0-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4f0cbfd0-739b-0130-e17c-282066132de2\"},\"uuid\":\"4f0cbfd0-739b-0130-e17c-282066132de2\",\"name\":\"sample_2\"},\"type\":\"DNA\",\"unit\":\"mole\"}],\"labels\":{\"actions\":{\"read\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/4e5b1240-739b-0130-e17c-282066132de2\"},\"uuid\":\"4e5b1240-739b-0130-e17c-282066132de2\",\"barcode\":{\"value\":\"1234567892700\",\"type\":\"2d-barcode\"}}}}}}"

  # Add the tube rack in the order and start it


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock DNA\":{\"4efbbb10-739b-0130-e17c-282066132de2\":{\"event\":\"start\",\"batch_uuid\":\"3dee3590-739b-0130-e17c-282066132de2\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"4efbbb10-739b-0130-e17c-282066132de2\",\"status\":\"in_progress\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  # Change the type of the rube rack to complete


    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"items\":{\"Stock DNA\":{\"4efbbb10-739b-0130-e17c-282066132de2\":{\"event\":\"complete\"}}},\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"in_progress\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"4efbbb10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"





    response = put "/388380e0-739b-0130-e1a1-282066132de2", "{\"event\":\"complete\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/388380e0-739b-0130-e1a1-282066132de2\"},\"uuid\":\"388380e0-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"completed\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"387e3a10-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"387fb8d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"3f7a1080-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3fa29820-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"3fcea780-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"3ffc72e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4374e610-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43a9b970-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"40efb5e0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"412f7bd0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"41fc42f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"423f0880-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"431df1d0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"43440930-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"447e89b0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"44bc3bc0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4a4706a0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4a6ec850-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4cde6740-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4d1014b0-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4b539010-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"4de52660-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"





    response = put "/38854f60-739b-0130-e1a1-282066132de2", "{\"event\":\"complete\",\"user\":\"username\"}" 
    response.status.should == 200
    response.body.should match_json "{\"order\":{\"actions\":{\"read\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/38854f60-739b-0130-e1a1-282066132de2\"},\"uuid\":\"38854f60-739b-0130-e1a1-282066132de2\",\"pipeline\":\"DNA+RNA manual extraction\",\"status\":\"completed\",\"parameters\":{},\"state\":{},\"cost_code\":\"cost code\",\"creator\":{\"actions\":{\"read\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d2a80-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d2a80-739b-0130-e1a1-282066132de2\"},\"study\":{\"actions\":{\"read\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"create\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"update\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\",\"delete\":\"http://example.org/387d3760-739b-0130-e1a1-282066132de2\"},\"uuid\":\"387d3760-739b-0130-e1a1-282066132de2\"},\"items\":{\"tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_tube_to_be_extracted_na+p\":[{\"uuid\":\"388146d0-739b-0130-e1a1-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_dna\":[{\"uuid\":\"45f59a80-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"by_product_tube_rna+p\":[{\"uuid\":\"46277610-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4895f040-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_dna\":[{\"uuid\":\"46eede00-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"tube_to_be_extracted_rna+p\":[{\"uuid\":\"47a44fb0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"binding_spin_column_rna\":[{\"uuid\":\"486e03f0-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"extracted_tube_rna\":[{\"uuid\":\"49542970-739b-0130-e17c-282066132de2\",\"status\":\"unused\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"name\":[{\"uuid\":\"4bb40c10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}},{\"uuid\":\"4e522e50-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock RNA\":[{\"uuid\":\"4c703770-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}],\"Stock DNA\":[{\"uuid\":\"4efbbb10-739b-0130-e17c-282066132de2\",\"status\":\"done\",\"batch\":{\"actions\":{\"read\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"create\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"update\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\",\"delete\":\"http://example.org/3dee3590-739b-0130-e17c-282066132de2\"},\"uuid\":\"3dee3590-739b-0130-e17c-282066132de2\",\"process\":null}}]}}}"

  end
end
